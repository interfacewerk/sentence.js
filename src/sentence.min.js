"use strict";function That(n,e){function t(){n.set(e,r.apply(null,Array.prototype.slice.call(arguments)))}var o,r,i=this;i.remove=function(){return o.remove(),i},i.is=function(){var e=Array.prototype.slice.call(arguments).slice(0,arguments.length-1);return r=arguments[arguments.length-1],o=n.when.apply(n,e),o.verify?o.verify(t):o.verifies(t),i}}var Sentence=function(){var n=this,e={},t=[];n._get=function(){if(0===arguments.length)return e;if(1===arguments.length)return e[arguments[0]];for(var n={},t=0;t<arguments.length;t++)n[arguments[t]]=e[arguments[t]];return n},n._set=function(){var o=JSON.parse(JSON.stringify(e)),r=[];if(1===arguments.length){var i=arguments[0];for(var u in i)e[u]=i[u],r.push(u)}else for(var l=0;l<arguments.length/2;l++)e[arguments[2*l]]=arguments[2*l+1],r.push(arguments[2*l]);return setTimeout(function(){var n=e;t.forEach(function(e){try{e.process(r,n,o)}catch(t){console.error("sentence.js: an error occured when processing a when")}})},0),n},n._remove=function(e){return t.some(function(n,o){return n===e?(t.splice(o,1),!0):!1}),n},n._when=function(){var e=Array.prototype.slice.call(arguments),o=new When(n,e);return t.push(o),o.interface},n._process=function(o){return t.some(function(n){return n.interface===o?(setTimeout(function(){var t=[];for(var o in e)t.push(o);n.process(t,e,e)},0),!0):!1}),n},n.says={that:function(e){var t=new That(n,e);return t}}};Sentence.prototype.get=function(){return this._get.apply(this,arguments)},Sentence.prototype.set=function(){return this._set.apply(this,arguments)},Sentence.prototype.when=function(){return this._when.apply(this,arguments)},Sentence.prototype.process=function(n){return this._process.call(this,n)};var When=function(n,e){function t(n,e,t){try{o.do&&o.do.call(null,e,t)}catch(r){console.error("sentence.js: error on do for "+n)}}var o=this,r=[];o.remove=function(){n._remove(o)},o.processWithOldValues=function(n){o.interface.processWithOldValues(n)},o.onVariable=function(n){return-1===r.indexOf(n)&&r.push(n),o};var i=e;o.onAnd=function(n){return n=0===n.length?i:n,i=n,n.forEach(function(n){o.onVariable(n)}),conditions(o,n,function(e){var t=o.toVerify;o.toVerify=function(o,r){function i(){if(1===n.length)return e.call(null,o,r);var t={},i={};return n.forEach(function(n){t[n]=o[n],i[n]=r[n]}),e.call(null,t,i)}return t.call(null,o,r)&&i()}})},o.do=void 0,o.otherwise=void 0,o.anyway=void 0,e.forEach(function(n){o.onVariable(n)}),o.interface=conditions(o,e,function(n){o.toVerify=function(e,t){return n.call(null,e,t)}}),o.interface.processWithOldValues=function(e){var t={},r=[];for(var i in e)r.push(i),t[i]=n.get(i);return o.process(r,t,e),o.interface},o.for=void 0;var u;o.process=function(n,e,i){if(!r.some(function(e){return-1!==n.indexOf(e)}))return o;if(o.toVerify&&o.toVerify.call(null,e,i))void 0!==o.for?u||(u=setTimeout(function(){u=void 0,t()},o.for)):t(n,e,i);else try{void 0!==o.for&&u&&(clearTimeout(u),u=void 0),o.otherwise&&o.otherwise.call(null,e,i)}catch(l){console.error("sentence.js: error on otherwise for "+n)}try{o.anyway&&o.anyway.call(null,e,i)}catch(l){console.error("sentence.js: error on anyway for "+n)}return o}},actions=function(n){var e={"do":function(t){return e.and=void 0,e.for=void 0,n.do=t,e},anyway:function(t){return e.and=void 0,e.for=void 0,n.anyway=t,e},otherwise:function(t){return e.and=void 0,e.for=void 0,n.otherwise=t,e},and:function(){return n.onAnd(Array.prototype.slice.call(arguments))},"for":function(t){return e.and=void 0,n.for=t,e},remove:function(){n.remove()},processWithOldValues:function(){return n.processWithOldValues.apply(this,arguments),this}};return e},conditions=function(n,e,t){if(1===e.length){var o=e[0];return{remove:function(){n.remove()},verifies:function(e){return t(function(n,t){return e(n[o],t[o])}),actions(n)},is:function(e){return t(function(n){return n[o]===e}),actions(n)},isNot:function(e){return t(function(n){return n[o]!==e}),actions(n)},isDefined:function(){return t(function(n){return void 0!==n[o]}),actions(n)},isUndefined:function(){return t(function(n){return void 0===n[o]}),actions(n)},becomes:function(e){return t(function(n,t){return n[o]===e&&n[o]!==t[o]}),actions(n)},updates:function(){return t(function(){return!0}),actions(n)}}}return{remove:function(){n.remove()},verify:function(o){return t(function(n,t){var r=[],i=[];return e.forEach(function(e){r.push(n[e]),i.push(t[e])}),o.apply(null,r.concat(i))}),actions(n)}}};String.prototype.milliseconds=function(){return Number(this)},String.prototype.seconds=function(){return 1e3*Number(this)},String.prototype.minutes=function(){return 6e4*Number(this)},String.prototype.hours=function(){return 36e5*Number(this)},String.prototype.days=function(){return 864e5*Number(this)},String.prototype.weeks=function(){return 6048e5*Number(this)};