"use strict";function That(n,r){function t(){n.set(r,o.apply(null,Array.prototype.slice.call(arguments)))}var e,o,i=this;i.remove=function(){return e.remove(),i},i.is=function(){var r=Array.prototype.slice.call(arguments).slice(0,arguments.length-1);return o=arguments[arguments.length-1],e=n.when.apply(n,r),e.verify?e.verify(t):e.verifies(t),i}}var Sentence=function(){var n=this,r={},t=[];n._get=function(){if(0===arguments.length)return r;if(1===arguments.length)return r[arguments[0]];for(var n={},t=0;t<arguments.length;t++)n[arguments[t]]=r[arguments[t]];return n},n._set=function(){var e=JSON.parse(JSON.stringify(r)),o=[];if(1===arguments.length){var i=arguments[0];for(var u in i)r[u]=i[u],o.push(u)}else for(var c=0;c<arguments.length/2;c++)r[arguments[2*c]]=arguments[2*c+1],o.push(arguments[2*c]);return setTimeout(function(){var n=JSON.parse(JSON.stringify(r));t.forEach(function(r){try{r.process(o,n,e)}catch(t){console.error("sentence.js: an error occured when processing a when")}})},0),n},n._remove=function(r){return t.some(function(n,e){return n===r?(t.splice(e,1),!0):!1}),n},n._when=function(){var r=Array.prototype.slice.call(arguments),e=new When(n,r);return t.push(e),e.interface},n._process=function(e){return t.some(function(n){return n.interface===e?(setTimeout(function(){var t=[];for(var e in r)t.push(e);n.process(t,r,r)},0),!0):!1}),n},n.says={that:function(r){var t=new That(n,r);return t}}};Sentence.prototype.get=function(){return this._get.apply(this,arguments)},Sentence.prototype.set=function(){return this._set.apply(this,arguments)},Sentence.prototype.when=function(){return this._when.apply(this,arguments)},Sentence.prototype.process=function(n){return this._process.call(this,n)};var When=function(n,r){function t(n,r,t){try{e.do&&e.do.call(null,r,t)}catch(o){console.error("sentence.js: error on do for "+n)}}var e=this,o=[];e.remove=function(){clearTimeout(u),u=void 0,n._remove(e)},e.processWithOldValues=function(n){e.interface.processWithOldValues(n)},e.onVariable=function(n){return-1===o.indexOf(n)&&o.push(n),e};var i=r;e.onAnd=function(n){return n=0===n.length?i:n,i=n,n.forEach(function(n){e.onVariable(n)}),conditions(e,n,function(r){var t=e.toVerify;e.toVerify=function(e,o){function i(){if(1===n.length)return r.call(null,e,o);var t={},i={};return n.forEach(function(n){t[n]=e[n],i[n]=o[n]}),r.call(null,t,i)}return t.call(null,e,o)&&i()}})},e.do=void 0,e.otherwise=void 0,e.anyway=void 0,r.forEach(function(n){e.onVariable(n)}),e.interface=conditions(e,r,function(n){e.toVerify=function(r,t){return n.call(null,r,t)}}),e.interface.processWithOldValues=function(r){var t={},o=[];for(var i in r)o.push(i),t[i]=n.get(i);return e.process(o,t,r),e.interface},e.for=void 0;var u;e.process=function(n,r,i){if(!o.some(function(r){return-1!==n.indexOf(r)}))return e;if(e.toVerify&&e.toVerify.call(null,r,i))void 0!==e.for?u||(u=setTimeout(function(){u=void 0,t()},e.for)):t(n,r,i);else try{void 0!==e.for&&u&&(clearTimeout(u),u=void 0),e.otherwise&&e.otherwise.call(null,r,i)}catch(c){console.error("sentence.js: error on otherwise for "+n)}try{e.anyway&&e.anyway.call(null,r,i)}catch(c){console.error("sentence.js: error on anyway for "+n)}return e}},actions=function(n){var r={"do":function(t){return r.and=void 0,r.for=void 0,n.do=t,r},anyway:function(t){return r.and=void 0,r.for=void 0,n.anyway=t,r},otherwise:function(t){return r.and=void 0,r.for=void 0,n.otherwise=t,r},and:function(){return n.onAnd(Array.prototype.slice.call(arguments))},"for":function(t){return r.and=void 0,n.for=t,r},remove:function(){n.remove()},processWithOldValues:function(){return n.processWithOldValues.apply(this,arguments),this}};return r},conditions=function(n,r,t){if(1===r.length){var e=r[0];return{remove:function(){n.remove()},verifies:function(r){return t(function(n,t){return r(n[e],t[e])}),actions(n)},is:function(r){return t(function(n){return n[e]===r}),actions(n)},isNot:function(r){return t(function(n){return n[e]!==r}),actions(n)},isDefined:function(){return t(function(n){return void 0!==n[e]}),actions(n)},isUndefined:function(){return t(function(n){return void 0===n[e]}),actions(n)},becomes:function(r){return t(function(n,t){return n[e]===r&&n[e]!==t[e]}),actions(n)},updates:function(){return t(function(){return!0}),actions(n)}}}return{remove:function(){n.remove()},verify:function(e){return t(function(n,t){var o=[],i=[];return r.forEach(function(r){o.push(n[r]),i.push(t[r])}),e.apply(null,o.concat(i))}),actions(n)}}};String.prototype.milliseconds=function(){return Number(this)},String.prototype.seconds=function(){return 1e3*Number(this)},String.prototype.minutes=function(){return 6e4*Number(this)},String.prototype.hours=function(){return 36e5*Number(this)},String.prototype.days=function(){return 864e5*Number(this)},String.prototype.weeks=function(){return 6048e5*Number(this)};